<div class="device-ports bg-white p-4 rounded-lg shadow-md">
    <div class="device-info mb-4">
        <h3 class="text-lg font-semibold text-gray-900">{{ device.name }}</h3>
        <p class="text-sm text-gray-600">{{ device.model }}</p>
    </div>

    <!-- Port Grid -->
    <div class="port-grid space-y-2">
        {% for row in range(8) %}
        <div class="flex space-x-2">
            {% for col in range(6) %}
            {% set port_num = row * 6 + col %}
            <button class="port-button w-8 h-8 rounded-full border-2 flex items-center justify-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if port.connected %}border-green-500{% else %}border-gray-300{% endif %}"
                    data-port-id="{{ port_num }}"
                    data-port-type="qsfp-dd"
                    data-port-speed="400G"
                    title="Port {{ port_num }} - QSFP-DD 400G {% if port.connected %}Connected to {{ port.connected_to }}{% else %}Available{% endif %}">
                <span class="text-xs font-medium text-gray-700">{{ port_num }}</span>
            </button>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <!-- Management & Power -->
    <div class="mt-6 border-t pt-4">
        <div class="flex justify-between items-center mb-4">
            <div class="flex space-x-4">
                <div class="power-module flex items-center">
                    <span class="text-sm text-gray-600 mr-2">PM0</span>
                    <div class="w-4 h-4 rounded-full {% if device.pm0_status == 'ok' %}bg-green-500{% else %}bg-red-500{% endif %}"></div>
                </div>
                <div class="power-module flex items-center">
                    <span class="text-sm text-gray-600 mr-2">PM1</span>
                    <div class="w-4 h-4 rounded-full {% if device.pm1_status == 'ok' %}bg-green-500{% else %}bg-red-500{% endif %}"></div>
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="management-port flex items-center">
                    <span class="text-sm text-gray-600 mr-2">RJ45</span>
                    <div class="w-4 h-4 rounded-full border-2 border-gray-300"></div>
                </div>
                <div class="management-port flex items-center">
                    <span class="text-sm text-gray-600 mr-2">MGT</span>
                    <div class="w-4 h-4 rounded-full border-2 border-gray-300"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Port Details -->
    <div class="mt-4 border-t pt-4">
        <h4 class="text-sm font-medium text-gray-900 mb-2">Port Details</h4>
        <div class="text-sm text-gray-600">
            <div class="flex justify-between mb-1">
                <span>Type:</span>
                <span>QSFP-DD</span>
            </div>
            <div class="flex justify-between mb-1">
                <span>Speed:</span>
                <span>400G</span>
            </div>
            <div class="flex justify-between">
                <span>Status:</span>
                <span id="selected-port-status">Select a port</span>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const portButtons = document.querySelectorAll('.port-button');
    let selectedPort = null;

    portButtons.forEach(button => {
        button.addEventListener('click', () => {
            if (selectedPort === button) {
                // Deselect port
                button.classList.remove('ring-2', 'ring-blue-500');
                selectedPort = null;
                document.getElementById('selected-port-status').textContent = 'Select a port';
            } else {
                // Select port
                if (selectedPort) {
                    selectedPort.classList.remove('ring-2', 'ring-blue-500');
                }
                button.classList.add('ring-2', 'ring-blue-500');
                selectedPort = button;
                
                // Update port details
                const portNum = button.dataset.portId;
                const portType = button.dataset.portType;
                const portSpeed = button.dataset.portSpeed;
                document.getElementById('selected-port-status').textContent = 
                    `Port ${portNum} - ${portType.toUpperCase()} ${portSpeed}`;

                // Emit port selection event
                const event = new CustomEvent('port-selected', {
                    detail: {
                        portId: portNum,
                        portType: portType,
                        portSpeed: portSpeed,
                        deviceId: '{{ device.id }}'
                    }
                });
                document.dispatchEvent(event);
            }
        });
    });
});
</script>
